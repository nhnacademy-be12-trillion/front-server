<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<head>
    <meta charset="utf-8">
    <title>Trillion-Shop | 메인</title>

    <th:block layout:fragment="head">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="Book Store, E-commerce" name="keywords">
        <meta content="Online Book Store" name="description">
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <!-- ============ 메인 상단: 캐러셀 + 프로모션 ============ -->
    <div class="container-fluid mb-3">
        <div class="row px-xl-5">
            <!-- 캐러셀 -->
            <div class="col-lg-8">
                <div id="header-carousel"
                     class="carousel slide carousel-fade mb-30 mb-lg-0"
                     data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#header-carousel" data-slide-to="0" class="active"></li>
                        <li data-target="#header-carousel" data-slide-to="1"></li>
                    </ol>
                    <div class="carousel-inner">
                        <div class="carousel-item position-relative active" style="height: 430px;">
                            <img class="position-absolute w-100 h-100"
                                 th:src="@{/img/carousel-1.jpg}"
                                 style="object-fit: cover;">
                            <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                                <div class="p-3" style="max-width: 700px;">
                                    <h1 class="display-4 text-white mb-3 animate__animated animate__fadeInDown">
                                        Best Seller
                                    </h1>
                                    <p class="mx-md-5 px-5 animate__animated animate__bounceIn">
                                        지금 가장 사랑받는 베스트 셀러를 만나보세요.
                                    </p>
                                    <a class="btn btn-outline-light py-2 px-4 mt-3 animate__animated animate__fadeInUp"
                                       th:href="@{/api/books}">
                                        지금 보러가기
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-item position-relative" style="height: 430px;">
                            <img class="position-absolute w-100 h-100"
                                 th:src="@{/img/carousel-2.jpg}"
                                 style="object-fit: cover;">
                            <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                                <div class="p-3" style="max-width: 700px;">
                                    <h1 class="display-4 text-white mb-3 animate__animated animate__fadeInDown">
                                        New Arrival
                                    </h1>
                                    <p class="mx-md-5 px-5 animate__animated animate__bounceIn">
                                        따끈따끈한 신간들을 확인해보세요.
                                    </p>
                                    <a class="btn btn-outline-light py-2 px-4 mt-3 animate__animated animate__fadeInUp"
                                       th:href="@{/api/books}">
                                        신간 보기
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽 프로모션 카드 2개 -->
            <div class="col-lg-4">
                <div class="product-offer mb-30" style="height: 200px;">
                    <img class="img-fluid" th:src="@{/img/offer-1.jpg}" alt="프로모션 1">
                    <div class="offer-text">
                        <h6 class="text-white text-uppercase">Save 20%</h6>
                        <h3 class="text-white mb-3">주간 특가</h3>
                        <a th:href="@{/api/books}" class="btn btn-primary">보러가기</a>
                    </div>
                </div>
                <div class="product-offer mb-30" style="height: 200px;">
                    <img class="img-fluid" th:src="@{/img/offer-2.jpg}" alt="프로모션 2">
                    <div class="offer-text">
                        <h6 class="text-white text-uppercase">Gift</h6>
                        <h3 class="text-white mb-3">선물하기 좋은 책</h3>
                        <a th:href="@{/api/books}" class="btn btn-primary">보러가기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ 추천 도서 (PageResponse<BookListResponse>) ============ -->
    <div class="container-fluid pt-5 pb-3">
        <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
            <span class="bg-secondary pr-3">추천 도서</span>
        </h2>

        <!-- books: PageResponse<BookListResponse> -->
        <div class="row px-xl-5"
             th:if="${books != null and books.content != null and !#lists.isEmpty(books.content)}">

            <div class="col-lg-3 col-md-4 col-sm-6 pb-1"
                 th:each="book : ${books.content}">
                <div class="product-item bg-light mb-4">

                    <!-- 도서 이미지 -->
                    <div class="product-img position-relative overflow-hidden">
                        <img class="img-fluid w-100"
                             th:src="${book.bookImage} != null ? ${book.bookImage} : '/img/product-1.jpg'"
                             alt="도서 이미지"
                             style="aspect-ratio: 1/1.4; object-fit: cover;">
                        <div class="product-action">
                            <!-- 장바구니 -->
                            <a class="btn btn-outline-dark btn-square"
                               th:href="@{/api/carts/add(bookId=${book.bookId})}">
                                <i class="fa fa-shopping-cart"></i>
                            </a>
                            <!-- 좋아요 -->
                            <a class="btn btn-outline-dark btn-square"
                               th:href="@{/api/members/likes/add(bookId=${book.bookId})}">
                                <i class="far fa-heart"></i>
                            </a>
                            <!-- 상세보기 -->
                            <a class="btn btn-outline-dark btn-square"
                               th:href="@{/api/books/{id}(id=${book.bookId})}">
                                <i class="fa fa-search"></i>
                            </a>
                        </div>
                    </div>

                    <!-- 도서 정보 -->
                    <div class="text-center py-4 px-2">

                        <!-- 제목 -->
                        <a class="h6 text-decoration-none text-truncate d-block mb-1"
                           th:href="@{/api/books/{id}(id=${book.bookId})}"
                           th:text="${book.bookName != null ? book.bookName : '제목 정보 없음'}">
                            도서 제목
                        </a>

                        <!-- 저자 / 출판사 -->
                        <div class="small text-muted mb-2">
                            <span th:text="${book.bookAuthor != null ? book.bookAuthor : '저자 정보 없음'}">
                                저자명
                            </span>
                            <span th:if="${book.bookPublisher != null}">
                                &nbsp;·&nbsp;
                                <span th:text="${book.bookPublisher}">출판사</span>
                            </span>
                        </div>

                        <!-- 가격 / 할인 -->
                        <div class="d-flex align-items-center justify-content-center mt-1">

                            <!-- 세일가 있을 때 -->
                            <div th:if="${book.bookSalePrice > 0}">
                                <h5 class="text-primary mb-0"
                                    th:text="${#numbers.formatInteger(book.bookSalePrice, 0, 'COMMA')} + '원'">
                                    12,000원
                                </h5>
                                <h6 class="text-muted ml-2 mb-0">
                                    <del th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + '원'">
                                        15,000원
                                    </del>
                                </h6>
                                <span class="badge badge-danger ml-2"
                                      th:text="${book.discountRate} + '%'">
                                    20%
                                </span>
                            </div>

                            <!-- 할인 없는 경우 -->
                            <div th:if="${book.bookSalePrice == 0}">
                                <h5 class="text-primary mb-0"
                                    th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + '원'">
                                    15,000원
                                </h5>
                            </div>
                        </div>

                        <!-- 평점 -->
                        <div class="d-flex align-items-center justify-content-center mt-2">
                            <div class="text-warning mr-1">
                                <i class="fa fa-star"></i>
                            </div>
                            <small class="text-muted">
                                <span th:text="${book.bookReviewRate != null ? book.bookReviewRate : 0}">0</span>
                                / 5.0
                            </small>
                        </div>

                        <!-- 상태 -->
                        <div class="mt-2">
                            <span class="badge badge-info"
                                  th:if="${book.bookState != null}"
                                  th:text="${book.bookState}">
                                상태
                            </span>
                            <span class="badge badge-secondary"
                                  th:if="${book.bookState == null}">
                                상태 정보 없음
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- 도서가 없을 때 -->
        <div class="row px-xl-5"
             th:if="${books == null or books.content == null or #lists.isEmpty(books.content)}">
            <div class="col-12 text-center py-5">
                <h4 class="text-muted mb-0">현재 표시할 도서가 없습니다.</h4>
                <p class="text-muted mt-2 mb-0">
                    도서가 등록되면 이 영역에서 추천 도서를 확인하실 수 있어요.
                </p>
            </div>
        </div>
    </div>

    <!-- ============ 하단 프로모션 2개 ============ -->
    <div class="container-fluid pt-5 pb-3">
        <div class="row px-xl-5">
            <div class="col-md-6">
                <div class="product-offer mb-30" style="height: 300px;">
                    <img class="img-fluid" th:src="@{/img/offer-1.jpg}" alt="프로모션">
                    <div class="offer-text">
                        <h6 class="text-white text-uppercase">오늘만 이 가격</h6>
                        <h3 class="text-white mb-3">한정 수량 특가</h3>
                        <a th:href="@{/api/books}" class="btn btn-primary">바로 가기</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="product-offer mb-30" style="height: 300px;">
                    <img class="img-fluid" th:src="@{/img/offer-2.jpg}" alt="프로모션">
                    <div class="offer-text">
                        <h6 class="text-white text-uppercase">선물 추천</h6>
                        <h3 class="text-white mb-3">소중한 사람에게 책 선물</h3>
                        <a th:href="@{/api/books}" class="btn btn-primary">바로 가기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <!-- 메인 전용 JS 필요하면 여기 -->
</th:block>

</body>
</html>
