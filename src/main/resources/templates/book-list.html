<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<head>
    <meta charset="UTF-8">
    <title>Trillion-Shop | 도서 목록</title>

    <th:block layout:fragment="head">
        <!-- 페이지 전용 head 요소 (필요 시 추가) -->
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <div class="container-fluid">
        <div class="row px-xl-5">

            <!-- ====== 왼쪽 카테고리(옵션) ====== -->
            <div class="col-lg-3 col-md-4">
                <h5 class="section-title position-relative text-uppercase mb-3">
                    <span class="bg-secondary pr-3">도서 메뉴</span>
                </h5>

                <div class="nav flex-column nav-pills book-menu" role="tablist">
                    <a class="nav-link active" data-toggle="pill" href="#tab-all">전체 도서</a>
                    <a class="nav-link" href="#" th:href="@{/api/books?sort=best}">베스트</a>
                    <a class="nav-link" href="#" th:href="@{/api/books?sort=new}">최근 발매</a>
                    <a class="nav-link" href="#" th:href="@{/api/books/birthday}">생일책</a>
                </div>
            </div>

            <!-- ====== 오른쪽 리스트 영역 ====== -->
            <div class="col-lg-9 col-md-8">

                <h5 class="section-title position-relative text-uppercase mb-3">
                    <span class="bg-secondary pr-3">도서 목록</span>
                </h5>

                <div class="row">

                    <!-- ====== books 리스트 렌더링 ====== -->
                    <div class="col-lg-3 col-md-4 col-sm-6 pb-1"
                         th:each="book : ${books}">

                        <div class="book-card">

                            <!-- 썸네일: 없으면 fallback 이미지 -->
                            <a th:href="@{/api/books/{id}(id=${book.bookId})}">
                                <img th:src="${book.bookImage} != null ? ${book.bookImage} : '/img/default-book.png'"
                                     alt="Book Thumbnail"
                                     style="width:100%; aspect-ratio:3/4; object-fit:cover;">
                            </a>

                            <!-- 도서명 -->
                            <div class="book-card-title"
                                 th:text="${book.bookName != null ? book.bookName : '제목 정보 없음'}">
                                책 제목
                            </div>

                            <!-- 저자 -->
                            <div class="book-card-author"
                                 th:text="${book.bookAuthor != null ? book.bookAuthor : '저자 정보 없음'}">
                                저자명
                            </div>

                            <!-- 출판사 (null 방어) -->
                            <div class="book-card-author small text-muted"
                                 th:text="${book.bookPublisher != null ? book.bookPublisher : '출판사 정보 없음'}">
                                출판사명
                            </div>

                            <!-- 도서 상태 -->
                            <div class="mt-1">
                                <span class="badge badge-info"
                                      th:if="${book.bookState != null}"
                                      th:text="${book.bookState}">
                                    NEW
                                </span>
                                <span class="badge badge-secondary" th:if="${book.bookState == null}">
                                    상태 미표기
                                </span>
                            </div>

                            <!-- 가격 -->
                            <div class="book-card-price mt-2">

                                <!-- 세일가: 없으면 정상가만 -->
                                <div th:if="${book.bookSalePrice > 0}">
                                    <span class="text-primary font-weight-bold"
                                          th:text="${#numbers.formatInteger(book.bookSalePrice, 0, 'COMMA')} + '원'">
                                        12,000원
                                    </span>

                                    <span class="text-muted ml-1">
                                        <del th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + '원'">
                                            15,000원
                                        </del>
                                    </span>

                                    <span class="ml-1 badge badge-danger"
                                          th:text="${book.discountRate + '%'}">
                                        20%
                                    </span>
                                </div>

                                <!-- 할인 없는 경우 -->
                                <div th:if="${book.bookSalePrice == 0}">
                                    <span class="text-primary font-weight-bold"
                                          th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + '원'">
                                        15,000원
                                    </span>
                                </div>

                            </div>

                            <!-- 별점 -->
                            <div class="mt-1">
                                <span class="text-warning">
                                    ★
                                </span>
                                <span th:text="${book.bookReviewRate != null ? book.bookReviewRate : 0}">
                                    0
                                </span> / 5
                            </div>

                            <!-- 버튼 영역 -->
                            <div class="mt-3 d-flex justify-content-between">
                                <!-- 좋아요 -->
                                <button type="button" class="btn btn-sm btn-outline-secondary"
                                        th:onclick="'location.href=\'/api/books/' + ${book.bookId} + '/like\''">
                                    <i class="fas fa-heart"></i>
                                </button>

                                <!-- 장바구니 -->
                                <button type="button" class="btn btn-sm btn-primary"
                                        th:onclick="'location.href=\'/api/carts?bookId=' + ${book.bookId} + '\''">
                                    장바구니
                                </button>
                            </div>

                        </div>

                    </div>


                    <!-- ====== books 리스트가 비었을 때 ====== -->
                    <div class="col-12"
                         th:if="${books == null or #lists.isEmpty(books)}">
                        <div class="bg-light text-center py-5">
                            <h5 class="text-muted mb-2">검색 결과가 없습니다.</h5>
                            <a th:href="@{/api/books}" class="btn btn-primary btn-sm">전체 도서 보기</a>
                        </div>
                    </div>

                </div>

            </div>

        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <!-- 이 페이지에서만 필요한 JS가 있으면 여기 작성 -->
</th:block>

</body>
</html>
