<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<th:block th:fragment="topbar">
  <!-- 회색 상단바 -->
  <div class="row bg-secondary py-1 px-xl-5">
    <div class="col-lg-6 d-none d-lg-block">
      <div class="d-inline-flex align-items-center h-100">
        <a class="text-body mr-3" href="">About</a>
        <a class="text-body mr-3" href="">Contact</a>
        <a class="text-body mr-3" href="">Help</a>
        <a class="text-body mr-3" href="">FAQs</a>
      </div>
    </div>

    <div class="col-lg-6 text-center text-lg-right">
      <!-- 모바일: 좋아요 / 장바구니 -->
      <div class="d-inline-flex align-items-center d-block d-lg-none">
        <a th:href="@{/api/members/likes}" class="btn px-0 ml-2">
          <i class="fas fa-heart text-dark"></i>
          <span class="badge text-dark border border-dark rounded-circle"
                style="padding-bottom: 2px;">0</span>
        </a>
        <a th:href="@{/api/carts}" class="btn px-0 ml-2">
          <i class="fas fa-shopping-cart text-dark"></i>
          <span class="badge text-dark border border-dark rounded-circle"
                style="padding-bottom: 2px;">0</span>
        </a>
      </div>
    </div>
  </div>

  <!-- 로고 / 검색 / 로그인 영역 -->
  <div class="row align-items-center bg-light py-3 px-xl-5 d-none d-lg-flex">
    <!-- 로고 -->
    <div class="col-lg-4">
      <a th:href="@{/}" class="text-decoration-none">
        <img th:src="@{/img/logo.png}"
             alt="Trillion-Shop Logo"
             class="img-fluid"
             style="background-color: #fff;">
      </a>
    </div>

    <!-- 검색 -->
    <div class="col-lg-4 col-6 text-left">
      <form th:action="@{/api/books/search}" method="get">
        <div class="input-group">
          <input type="text" name="keyword" class="form-control"
                 placeholder="도서를 검색해 보세요">
          <div class="input-group-append">
            <button type="submit" class="input-group-text bg-transparent text-primary">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- 로그인 / 회원 / 마이페이지 -->
    <div class="col-lg-4 col-6 text-right">
      <!-- 비로그인 -->
      <div class="d-inline-flex align-items-center justify-content-end w-100"
           th:if="${member == null}">
        <a th:href="@{/api/auth/login}" class="btn btn-sm btn-outline-primary mx-1">
          로그인
        </a>
        <a th:href="@{/api/auth/signup}" class="btn btn-sm btn-primary mx-1">
          회원가입
        </a>
        <a th:href="@{/orders/non-members-form}" class="btn text-dark btn-sm btn-outline-secondary mx-1">
          비회원 주문조회
        </a>
      </div>

      <!-- 로그인 -->
      <div class="d-inline-flex flex-column align-items-end w-100"
           th:unless="${member == null}">
        <span class="small mb-2"
              th:text="${member.name} + ' 님, 환영합니다'">
          홍길동 님, 환영합니다
        </span>
        <div>
          <a th:href="@{/api/members/my-page}" class="btn btn-sm btn-primary mx-1">
            마이페이지
          </a>
          <a th:href="@{/api/auth/logout}" class="btn text-dark btn-sm btn-outline-secondary mx-1">
            로그아웃
          </a>
        </div>
      </div>
    </div>
  </div>
</th:block>

<th:block th:fragment="navbar">
  <!-- base.html 에서 container-fluid bg-dark 가 감싸고 있음 -->
  <div class="row px-xl-5">
    <!-- 왼쪽 카테고리(접히는 메뉴) -->
    <div class="col-lg-3 d-none d-lg-block">
      <a id="btn-category-toggle"
         class="btn d-flex align-items-center justify-content-between bg-primary w-100"
         href="javascript:void(0)"
         style="height: 65px; padding: 0 30px;">
        <h6 class="text-dark m-0">
          <i class="fa fa-bars mr-2"></i>Categories
        </h6>
        <i class="fa fa-angle-down text-dark"></i>
      </a>

      <nav id="navbar-vertical"
           class="collapse position-absolute navbar navbar-vertical navbar-light
                  align-items-start p-0 bg-light"
           style="width: calc(100% - 30px); z-index: 999;">
        <div class="navbar-nav w-100">
          <!-- 카테고리 리스트가 있을 때 -->
          <th:block th:if="${categories != null and !#lists.isEmpty(categories)}">
            <a th:each="cat : ${categories}"
               th:href="@{/api/books(categoryId=${cat.categoryId})}"
               class="nav-item nav-link"
               th:text="${cat.categoryName}">
              Category Name
            </a>
          </th:block>

          <!-- 카테고리가 비어 있을 때 fallback -->
          <th:block th:unless="${categories != null and !#lists.isEmpty(categories)}">
            <a href="javascript:void(0)" class="nav-item nav-link">국내도서</a>
            <a href="javascript:void(0)" class="nav-item nav-link">외국도서</a>
          </th:block>
        </div>
      </nav>
    </div>

    <!-- 오른쪽 상단 메뉴 -->
    <div class="col-lg-9">
      <nav class="navbar navbar-expand-lg bg-dark navbar-dark py-3 py-lg-0 px-0">
        <button type="button" class="navbar-toggler"
                data-toggle="collapse" data-target="#navbarCollapse">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between"
             id="navbarCollapse">
          <div class="navbar-nav mr-auto py-0">
            <a th:href="@{/}" class="nav-item nav-link">
              베스트
            </a>
            <a th:href="@{/api/books?sort=new}" class="nav-item nav-link">
              최근 발매
            </a>
            <a th:href="@{/api/books/birthday}" class="nav-item nav-link">
              생일책
            </a>
          </div>

          <!-- 좋아요/장바구니 아이콘 -->
          <div class="navbar-nav ml-auto py-0 d-none d-lg-block">
            <a th:href="@{/api/members/likes}" class="btn px-0">
              <i class="fas fa-heart text-primary"></i>
              <span class="badge text-secondary border border-secondary rounded-circle"
                    style="padding-bottom: 2px;">0</span>
            </a>
            <a th:href="@{/api/carts}" class="btn px-0 ml-3">
              <i class="fas fa-shopping-cart text-primary"></i>
              <span class="badge text-secondary border border-secondary rounded-circle"
                    style="padding-bottom: 2px;">0</span>
            </a>
          </div>
        </div>
      </nav>
    </div>
  </div>
</th:block>
</html>
