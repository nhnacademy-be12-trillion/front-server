<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 50px; text-align: center; background-color: #f0f2f5; }
        .box {
            border: 1px solid #ddd;
            padding: 30px;
            display: inline-block;
            border-radius: 15px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
        }
        .badge-area { font-size: 24px; margin: 20px 0; position: relative; display: inline-block;}
        .badge {
            background-color: #ff4757; color: white;
            padding: 4px 10px; border-radius: 50px; font-weight: bold; font-size: 14px;
            position: absolute; top: -10px; right: -20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        button {
            padding: 12px 24px; font-size: 16px; cursor: pointer; margin: 5px;
            border: none; border-radius: 8px;
            transition: background 0.2s;
        }
        button:hover { opacity: 0.9; }
        button.add { background-color: #2ed573; color: white; }
        button.clear { background-color: #ff6b81; color: white; }
        button.refresh { background-color: #70a1ff; color: white; }

        .debug { margin-top: 20px; color: #57606f; font-family: monospace; text-align: left; background: #f1f2f6; padding: 15px; border-radius: 8px;}

        /* [ì¶”ê°€ëœ ì„¤ëª… ë°•ìŠ¤ ìŠ¤íƒ€ì¼] */
        .note {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 20px;
            text-align: left;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<div class="box">
    <h1>ğŸ›’ Header Badge Test</h1>

    <div class="badge-area" th:object="${cartSummary}">
        <span style="font-size: 50px;">ğŸ›’</span>

        <span id="ui-badge" class="badge"
              th:if="*{totalQuantity > 0}"
              th:text="*{totalQuantity}">0</span>
    </div>

    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

    <div>
        <button class="add" onclick="addToCart()">+ ìƒí’ˆ ë‹´ê¸° (Mock)</button>
        <button class="clear" onclick="clearCart()">ğŸ—‘ï¸ ë¹„ìš°ê¸°</button>
        <button class="refresh" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="note">
        <strong>â„¹ï¸ í…ŒìŠ¤íŠ¸ ë¡œì§ ì•ˆë‚´ (Mock Logic)</strong><br>
        ì´ ë²„íŠ¼ì€ ì‹¤ì œ DBë¥¼ í†µí•˜ì§€ ì•Šê³  <strong>ê°€ì§œ ë°ì´í„°</strong>ë¥¼ ì¿ í‚¤ì— êµ½ìŠµë‹ˆë‹¤.<br>
        <ul>
            <li><strong>ì¢…ë¥˜(Line Count):</strong> ë²„íŠ¼ í´ë¦­ ì‹œ <u>1ê°œì”©</u> ì¦ê°€</li>
            <li><strong>ì´ìˆ˜ëŸ‰(Total Qty):</strong> ì¢…ë¥˜ Ã— 2 (í•­ìƒ <u>2ë°°ìˆ˜</u>ë¡œ ì¦ê°€)</li>
        </ul>
        <small>* í…ŒìŠ¤íŠ¸ ëª©ì : ì¢…ë¥˜ì™€ ìˆ˜ëŸ‰ì´ ë‹¤ë¥¼ ë•Œ UIê°€ ê¹¨ì§€ì§€ ì•ŠëŠ”ì§€ í™•ì¸ìš©</small>
    </div>

    <div class="debug" th:object="${cartSummary}">
        <strong>[Server Side Data Check]</strong><br>
        - Line Count (ì¢…ë¥˜ ìˆ˜): <span id="debug-count" th:text="*{lineCount}">0</span><br>
        - Total Qty (ì „ì²´ ìˆ˜ëŸ‰): <span th:text="*{totalQuantity}">0</span>
    </div>
</div>

<script>
    function getCurrentCount() {
        const el = document.getElementById('debug-count');
        return el ? parseInt(el.innerText) : 0;
    }

    function addToCart() {
        const current = getCurrentCount();

        // UX: ë²„íŠ¼ ëˆ„ë¥´ìë§ˆì ì•½ê°„ì˜ ì§€ì—° í›„ ê°±ì‹ 
        fetch('/test/cart/badge/add?currentCount=' + current, { method: 'POST' })
            .then(res => {
                if(res.ok) {
                    location.reload();
                } else {
                    alert('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (ë¡œê·¸ í™•ì¸ í•„ìš”)');
                }
            });
    }

    function clearCart() {
        fetch('/test/cart/badge/clear', { method: 'POST' })
            .then(res => {
                if(res.ok) location.reload();
            });
    }
</script>
</body>
</html>