<!--
  ~ /*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  ~ + Copyright 2025. NHN Academy Corp. All rights reserved.
  ~ + * While every precaution has been taken in the preparation of this resource,  assumes no
  ~ + responsibility for errors or omissions, or for damages resulting from the use of the information
  ~ + contained herein
  ~ + No part of this resource may be reproduced, stored in a retrieval system, or transmitted, in any
  ~ + form or by any means, electronic, mechanical, photocopying, recording, or otherwise, without the
  ~ + prior written permission.
  ~ +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
  -->

<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">

<head>
    <meta charset="UTF-8">
    <title>Trillion-Shop | ë„ì„œ ëª©ë¡</title>

    <th:block layout:fragment="head">
    </th:block>
</head>

<body>
<div layout:fragment="content">

    <div class="container-fluid">
        <div class="row px-xl-5">

            <!-- ====== ì™¼ìª½ ì¹´í…Œê³ ë¦¬(ì˜µì…˜) ====== -->
            <div class="col-lg-3 col-md-4">
                <h5 class="section-title position-relative text-uppercase mb-3">
                    <span class="bg-secondary pr-3">ë„ì„œ ë©”ë‰´</span>
                </h5>

                <div class="nav flex-column nav-pills book-menu" role="tablist">
                    <a class="nav-link active" data-toggle="pill" href="#tab-all">ì „ì²´ ë„ì„œ</a>
                    <a class="nav-link" href="#" th:href="@{/books?sort=best}">ë² ìŠ¤íŠ¸</a>
                    <a class="nav-link" href="#" th:href="@{/books?sort=new}">ìµœê·¼ ë°œë§¤</a>
                    <a class="nav-link" href="#" th:href="@{/books/birthday}">ìƒì¼ì±…</a>
                </div>
            </div>

            <!-- ====== ì˜¤ë¥¸ìª½ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ ====== -->
            <div class="col-lg-9 col-md-8">

                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="section-title position-relative text-uppercase mb-0">
                        <span class="bg-secondary pr-3">ë„ì„œ ëª©ë¡</span>
                    </h5>

                    <!-- ì¹´ë“œí˜• / ì—´ê±°í˜• ì „í™˜ ë²„íŠ¼ -->
                    <div class="btn-group view-toggle-group" role="group" aria-label="View toggle">
                        <button type="button" id="btn-grid" class="btn btn-sm btn-primary">
                            <i class="fa fa-th-large mr-1"></i> ì¹´ë“œí˜•
                        </button>
                        <button type="button" id="btn-list" class="btn btn-sm btn-light">
                            <i class="fa fa-list mr-1"></i> ì—´ê±°í˜•
                        </button>
                    </div>
                </div>

                <!-- ====== ì¹´ë“œí˜• ë·° ====== -->
                <!-- âœ… ì¹´ë“œí˜• ê·¸ë¦¬ë“œ ë·° (hover ì‹œ ì¥ë°”êµ¬ë‹ˆ/ì¢‹ì•„ìš” ë…¸ì¶œ, CSSë§Œ ì‚¬ìš©) -->
                <div id="book-grid-view" class="row w-100">
                    <div class="col-lg-3 col-md-4 col-sm-6 pb-1" th:each="book : ${books}">
                        <div class="product-item bg-light mb-4 h-100">
                            <div class="product-img position-relative overflow-hidden">
                                <img class="img-fluid w-100"
                                     th:src="${book.bookImage != null ? book.bookImage : '/img/product-1.jpg'}"
                                     alt="" style="aspect-ratio: 1/1.4; object-fit: cover;">

                                <!-- ğŸ”¹ ì´ ë¶€ë¶„ì´ í˜¸ë²„ ì‹œ ë‚˜ì˜¤ëŠ” ë²„íŠ¼ë“¤ (CSSì— ì´ë¯¸ ìˆìŒ) -->
                                <div class="product-action">
                                    <a class="btn btn-outline-dark btn-square"
                                       th:href="@{/carts/add(bookId=${book.bookId})}">
                                        <i class="fa fa-shopping-cart"></i>
                                    </a>
                                    <a class="btn btn-outline-dark btn-square"
                                       th:href="@{/members/likes/add(bookId=${book.bookId})}">
                                        <i class="far fa-heart"></i>
                                    </a>
                                    <a class="btn btn-outline-dark btn-square"
                                       th:href="@{/books/{id}(id=${book.bookId})}">
                                        <i class="fa fa-search"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="text-center py-4">
                                <a class="h6 text-decoration-none text-truncate"
                                   th:href="@{/books/{id}(id=${book.bookId})}"
                                   th:text="${book.bookName}"
                                   style="display:block; max-width:90%; margin:0 auto;">
                                    Book Title
                                </a>

                                <div class="d-flex align-items-center justify-content-center mt-2">
                                    <h5 th:text="${#numbers.formatInteger(book.bookSalePrice, 0, 'COMMA')} + 'ì›'">12,000ì›</h5>
                                    <h6 class="text-muted ml-2">
                                        <del th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + 'ì›'">
                                            15,000ì›
                                        </del>
                                    </h6>
                                </div>

                                <div class="d-flex align-items-center justify-content-center mb-1">
                                    <small class="text-muted mr-2" th:text="${book.bookAuthor}">Author</small>
                                    <small class="text-muted" th:text="${book.bookPublisher}">Publisher</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- âœ… ë¦¬ìŠ¤íŠ¸í˜• ë·° (ìš°ì¸¡ì— ë²„íŠ¼ë“¤) -->
                <div id="book-list-view" class="d-none w-100">
                    <div class="bg-light mb-3 p-3 d-flex align-items-stretch"
                         th:each="book : ${books}">
                        <!-- ì¸ë„¤ì¼ -->
                        <div class="mr-3" style="width:120px;">
                            <a th:href="@{/books/{id}(id=${book.bookId})}">
                                <img class="img-fluid"
                                     th:src="${book.bookImage != null ? book.bookImage : '/img/product-1.jpg'}"
                                     alt="" style="aspect-ratio: 1/1.4; object-fit: cover;">
                            </a>
                        </div>

                        <!-- ë‚´ìš© -->
                        <div class="flex-grow-1 d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <a class="h6 text-decoration-none text-dark"
                                       th:href="@{/books/{id}(id=${book.bookId})}"
                                       th:text="${book.bookName}">
                                        Book Title
                                    </a>
                                    <div class="small text-muted" th:text="${book.bookAuthor}">Author</div>
                                    <div class="small text-muted" th:text="${book.bookPublisher}">Publisher</div>
                                </div>

                                <div class="text-right">
                                    <div class="font-weight-bold"
                                         th:text="${#numbers.formatInteger(book.bookSalePrice, 0, 'COMMA')} + 'ì›'">
                                        12,000ì›
                                    </div>
                                    <div class="small text-muted">
                                        <del th:text="${#numbers.formatInteger(book.bookRegularPrice, 0, 'COMMA')} + 'ì›'">
                                            15,000ì›
                                        </del>
                                    </div>
                                </div>
                            </div>

                            <!-- ì§§ì€ ì„¤ëª… -->
                            <p class="mt-2 mb-2 small text-muted text-truncate"
                               style="-webkit-line-clamp: 2; display: -webkit-box; -webkit-box-orient: vertical; overflow: hidden;"
                               th:text="${book.shortDescription}">
                                ì§§ì€ ì„¤ëª…ì´ ë“¤ì–´ê°€ëŠ” ì˜ì—­ì…ë‹ˆë‹¤. ìµœëŒ€ ë‘ ì¤„ ì •ë„ê¹Œì§€ë§Œ ë³´ì—¬ì¤ë‹ˆë‹¤.
                            </p>

                            <!-- ğŸ”¹ ìš°ì¸¡ ë²„íŠ¼ë“¤ (ìƒ‰ìƒ ë‹¤ë¥¸ ë²„íŠ¼) -->
                            <div class="d-flex justify-content-end mt-auto">
                                <a class="btn btn-sm btn-outline-dark mr-2"
                                   th:href="@{/carts/add(bookId=${book.bookId})}">
                                    ì¥ë°”êµ¬ë‹ˆ
                                </a>
                                <a class="btn btn-sm btn-outline-dark mr-2"
                                   th:href="@{/members/likes/add(bookId=${book.bookId})}">
                                    ì°œ
                                </a>
                                <a class="btn btn-sm btn-primary"
                                   th:href="@{/books/{id}(id=${book.bookId})}">
                                    ìƒì„¸ë³´ê¸°
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <script>
        // ë·° ì „í™˜ ë° ì¥ë°”êµ¬ë‹ˆ Ajax ì²˜ë¦¬
        (function () {
            // ì¹´ë“œí˜• / ë¦¬ìŠ¤íŠ¸í˜• í† ê¸€
            const $grid = $('#book-grid-view');
            const $list = $('#book-list-view');
            const $btnGrid = $('#btn-grid');
            const $btnList = $('#btn-list');

            $btnGrid.on('click', function () {
                $grid.removeClass('d-none');
                $list.addClass('d-none');

                $btnGrid.removeClass('btn-light').addClass('btn-primary text-white');
                $btnList.removeClass('btn-primary text-white').addClass('btn-light');
            });

            $btnList.on('click', function () {
                $grid.addClass('d-none');
                $list.removeClass('d-none');

                $btnList.removeClass('btn-light').addClass('btn-primary text-white');
                $btnGrid.removeClass('btn-primary text-white').addClass('btn-light');
            });

            // ì¥ë°”êµ¬ë‹ˆ Ajax ì¶”ê°€ (ì¹´ë“œí˜• & ë¦¬ìŠ¤íŠ¸í˜• ê³µí†µ)
            $(document).on('click', '.btn-add-cart', function () {
                const bookId = $(this).data('book-id');
                const quantity = 1; // ë¦¬ìŠ¤íŠ¸/ì¹´ë“œì—ì„œ ê¸°ë³¸ 1ê¶Œ

                $.ajax({
                    url: '/carts/add',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        bookId: bookId,
                        cartQuantity: quantity
                    }),
                    success: function (res) {
                        if (res && res.message) {
                            alert(res.message);
                        } else {
                            alert('ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìŠµë‹ˆë‹¤.');
                        }
                        // TODO: í—¤ë” ì¥ë°”êµ¬ë‹ˆ ê°œìˆ˜ ê°±ì‹  ë¡œì§ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì—ì„œ í˜¸ì¶œ
                    },
                    error: function (xhr) {
                        if (xhr.status === 401) {
                            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                            // location.href = '/api/auth/login';
                        } else {
                            alert('ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        }
                    }
                });
            });

        })();
    </script>
</th:block>

</body>
</html>
